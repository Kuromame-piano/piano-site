---
import Layout from "../../layouts/Layout.astro";
import { areas } from "../../data/areas";
import { type Area } from "../../data/areas";

export async function getStaticPaths() {
    return areas.map((area) => ({
        params: { slug: area.slug },
        props: { area },
    }));
}

interface Props {
    area: Area;
}

const { area } = Astro.props;

const pageTitle = `${area.name}の出張ピアノ教室 | 無料体験レッスン受付中`;
const pageDescription = `${area.name}（${area.subAreas.join(
    "・",
)}）での出張ピアノレッスン。${area.lead}`;

// Schema.org Structured Data
const schema = JSON.stringify({
    "@context": "https://schema.org",
    "@graph": [
        {
            "@type": "BreadcrumbList",
            itemListElement: [
                {
                    "@type": "ListItem",
                    position: 1,
                    item: {
                        "@id": Astro.site?.toString(),
                        name: "ホーム",
                    },
                },
                {
                    "@type": "ListItem",
                    position: 2,
                    item: {
                        "@id": new URL("/area", Astro.site).toString(),
                        name: "出張エリア",
                    },
                },
                {
                    "@type": "ListItem",
                    position: 3,
                    item: {
                        "@id": Astro.url.toString(),
                        name: area.name,
                    },
                },
            ],
        },
        {
            "@type": "Service",
            name: `${area.name}の出張ピアノ教室`,
            provider: {
                "@type": "MusicSchool",
                name: "髙橋遊月ピアノ教室",
                url: Astro.site?.toString(),
                image: new URL("/senzai.png", Astro.site).toString(),
            },
            areaServed: [
                {
                    "@type": "City",
                    name: area.name,
                },
                ...area.subAreas.map((sub) => ({
                    "@type": "Place",
                    name: sub,
                })),
            ],
            description: area.lead,
            url: Astro.url.toString(),
            potentialAction: {
                "@type": "ReserveAction",
                target: {
                    "@type": "EntryPoint",
                    urlTemplate: new URL("/contact", Astro.site).toString(),
                },
                result: {
                    "@type": "Reservation",
                    name: "体験レッスン",
                },
            },
        },
        // FAQPage Schema for rich results
        {
            "@type": "FAQPage",
            mainEntity: area.faqs.map((faq) => ({
                "@type": "Question",
                name: faq.question,
                acceptedAnswer: {
                    "@type": "Answer",
                    text: faq.answer,
                },
            })),
        },
    ],
});
---

<Layout
    title={pageTitle}
    description={pageDescription}
    image={area.mainImage}
    keywords={area.keywords}
>
    <!-- Structured Data -->
    <script slot="head" type="application/ld+json" set:html={schema} />
    <!-- Preload Critical Image -->
    <link slot="head" rel="preload" as="image" href={area.mainImage} />

    <div
        class="relative h-[60vh] flex items-center justify-center overflow-hidden"
    >
        <div class="absolute inset-0 z-0">
            <img
                src={area.mainImage}
                alt={area.mainImageAlt || `${area.name}の街並み`}
                class="w-full h-full object-cover opacity-60"
            />
            <div class="absolute inset-0 bg-[#544A40]/30"></div>
        </div>

        {/* Breadcrumbs (Visual) */}
        <div class="absolute top-24 left-0 right-0 z-20 px-6">
            <nav
                class="max-w-4xl mx-auto text-sm text-white/90 font-light"
                aria-label="Breadcrumb"
            >
                <ol class="flex items-center space-x-2">
                    <li>
                        <a href="/" class="hover:text-white transition-colors"
                            >ホーム</a
                        >
                    </li>
                    <li><span class="opacity-60">/</span></li>
                    <li>
                        <a
                            href="/area"
                            class="hover:text-white transition-colors"
                            >出張エリア</a
                        >
                    </li>
                    <li><span class="opacity-60">/</span></li>
                    <li class="font-medium text-white" aria-current="page">
                        {area.name}
                    </li>
                </ol>
            </nav>
        </div>
        <div class="relative z-10 text-center text-white px-6">
            <h1 class="text-3xl md:text-5xl font-serif mb-4 tracking-wider">
                {area.name}の出張ピアノ教室
            </h1>
            <p class="text-lg md:text-xl font-light opacity-90">
                Area Information
            </p>
        </div>
    </div>

    <section class="py-20 px-6 max-w-4xl mx-auto">
        <div class="text-center mb-16">
            <h2
                class="text-2xl md:text-3xl font-serif mb-8 text-[#544A40] leading-relaxed"
            >
                {area.catchphrase}
            </h2>
            <p class="text-[#544A40]/80 leading-8">
                {area.lead}
            </p>
        </div>

        <div class="space-y-16">
            {
                area.features.map((feature, index) => (
                    <div
                        class={`flex flex-col md:flex-row gap-8 items-center ${index % 2 === 1 ? "md:flex-row-reverse" : ""}`}
                    >
                        <div class="flex-1 space-y-4">
                            <h3 class="text-xl font-serif text-[#A88B58] border-l-4 border-[#A88B58] pl-4">
                                {feature.title}
                            </h3>
                            <p class="text-[#544A40]/80 leading-7 text-justify">
                                {feature.description}
                            </p>
                        </div>
                    </div>
                ))
            }
        </div>
    </section>

    {/* Unique Content Section */}
    {
        area.uniqueContent && (
            <section class="py-16 px-6 bg-white">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-serif mb-8 text-[#544A40] text-center">
                        {area.name}でピアノを始める
                    </h2>
                    <p class="text-[#544A40]/80 leading-8 text-justify">
                        {area.uniqueContent}
                    </p>
                </div>
            </section>
        )
    }

    <section class="bg-[#F3EFE9] py-20 px-6">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-2xl font-serif mb-8 text-[#544A40]">
                {area.name}のアクセス・対応エリア
            </h2>
            <p class="mb-4 text-[#544A40]/90 font-medium">
                {area.access}
            </p>
            <div class="flex flex-wrap justify-center gap-2 mb-8">
                {
                    area.keywords.map((keyword) => (
                        <span class="bg-white px-3 py-1 text-sm text-[#A88B58] rounded-full border border-[#A88B58]/20">
                            #{keyword}
                        </span>
                    ))
                }
            </div>
        </div>
    </section>

    {/* FAQ Section */}
    <section class="py-20 px-6 max-w-4xl mx-auto" id="faq">
        <h2 class="text-2xl font-serif mb-12 text-[#544A40] text-center">
            {area.name}でよくあるご質問
        </h2>
        <div class="space-y-4">
            {
                area.faqs.map((faq, index) => (
                    <details class="group bg-white rounded-lg shadow-sm border border-[#F1EBE4] overflow-hidden">
                        <summary class="flex items-center justify-between p-6 cursor-pointer list-none hover:bg-[#FCFAF7] transition-colors">
                            <span class="font-medium text-[#544A40] pr-4 text-left">
                                <span class="text-[#A88B58] mr-2">Q.</span>
                                {faq.question}
                            </span>
                            <span class="flex-shrink-0 w-6 h-6 flex items-center justify-center text-[#A88B58] transition-transform group-open:rotate-180">
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke-width="2"
                                    stroke="currentColor"
                                    class="w-5 h-5"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="M19.5 8.25l-7.5 7.5-7.5-7.5"
                                    />
                                </svg>
                            </span>
                        </summary>
                        <div class="px-6 pb-6 text-[#544A40]/80 leading-7 border-t border-[#F1EBE4]">
                            <p class="pt-4">
                                <span class="text-[#A88B58] font-medium mr-2">
                                    A.
                                </span>
                                {faq.answer}
                            </p>
                        </div>
                    </details>
                ))
            }
        </div>
    </section>

    {/* Trial Lesson CTA */}
    <section class="py-20 px-6 bg-[#544A40] text-white">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl font-serif mb-6">まずは無料体験レッスンから</h2>
            <p class="mb-10 text-lg opacity-90 leading-relaxed">
                {area.name}でピアノ教室をお探しの方へ。<br />
                ご自宅でのリラックスしたレッスンを体験してみませんか？
            </p>
            <a
                href="/contact"
                class="inline-block bg-[#A88B58] hover:bg-[#8A7246] text-white font-medium py-4 px-12 rounded-full transition-all duration-300 tracking-wider shadow-lg hover:shadow-xl transform hover:-translate-y-1"
            >
                無料体験レッスンに申し込む
            </a>
        </div>
    </section>

    <section class="py-20 px-6 max-w-4xl mx-auto text-center">
        <h2 class="text-xl font-serif mb-8 text-[#544A40] opacity-60">
            他のエリアを見る
        </h2>
        <div class="flex flex-wrap justify-center gap-4 text-sm">
            {
                areas.map(
                    (a) =>
                        a.slug !== area.slug && (
                            <a
                                href={`/area/${a.slug}`}
                                class="block px-6 py-3 border border-[#544A40]/20 text-[#544A40] hover:bg-[#544A40] hover:text-white transition-colors duration-300"
                            >
                                {a.name}
                            </a>
                        ),
                )
            }
        </div>
    </section>
</Layout>

<style>
    /* FAQ accordion animation */
    details[open] summary {
        border-bottom: none;
    }

    details summary::-webkit-details-marker {
        display: none;
    }
</style>

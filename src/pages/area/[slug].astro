---
import Layout from "../../layouts/Layout.astro";
import { areas } from "../../data/areas";
import { type Area } from "../../data/areas";
import HeroSection from "../../components/area/HeroSection.astro";
import IntroSection from "../../components/area/IntroSection.astro";
import PersonaSection from "../../components/area/PersonaSection.astro";
import UniqueContentSection from "../../components/area/UniqueContentSection.astro";
import LessonFlowSection from "../../components/area/LessonFlowSection.astro";
import MapSection from "../../components/area/MapSection.astro";
import FAQSection from "../../components/area/FAQSection.astro";
import CTASection from "../../components/area/CTASection.astro";

import InstructorSection from "../../components/area/InstructorSection.astro";
import FeeSection from "../../components/area/FeeSection.astro";
import RelatedAreasSection from "../../components/area/RelatedAreasSection.astro";
import Breadcrumbs from "../../components/common/Breadcrumbs.astro";

export async function getStaticPaths() {
    return areas.map((area) => ({
        params: { slug: area.slug },
        props: { area },
    }));
}

interface Props {
    area: Area;
}

const { area } = Astro.props;

// 画像の表示位置をエリアごとに調整
const getObjectPosition = (slug: string) => {
    if (["kiyosumi-shirakawa", "monzen-nakacho"].includes(slug)) {
        return "50% 55%";
    }
    if (["ningyocho", "morishita"].includes(slug)) {
        return "50% 50%";
    }
    // 東雲、勝どき、豊洲はピアノが見えるように少し下げる
    if (["shinonome", "kachidoki", "toyosu"].includes(slug)) {
        return "50% 45%";
    }
    return "50% 35%";
};
const objectPosition = getObjectPosition(area.slug);

const pageTitle = `${area.name}のピアノ教室｜出張レッスン専門・髙橋遊月ピアノ教室`;
const pageDescription =
    area.seo?.metaDescription ||
    `${area.name}のピアノ教室をお探しの方へ。講師がご自宅へ伺う出張専門のピアノ教室です。${area.metaSnippet || area.lead} 東京音大卒の女性講師によるマンツーマン指導。無料体験レッスン受付中。`;
const pageKeywords = area.seo
    ? [area.seo.primaryKeyword, ...area.seo.secondaryKeywords]
    : area.keywords;

// Schema.org Structured Data
const schema = JSON.stringify({
    "@context": "https://schema.org",
    "@graph": [
        {
            "@type": "BreadcrumbList",
            itemListElement: [
                {
                    "@type": "ListItem",
                    position: 1,
                    item: {
                        "@id": Astro.site?.toString(),
                        name: "ホーム",
                    },
                },
                {
                    "@type": "ListItem",
                    position: 2,
                    item: {
                        "@id": new URL("/area", Astro.site).toString(),
                        name: "出張エリア",
                    },
                },
                {
                    "@type": "ListItem",
                    position: 3,
                    item: {
                        "@id": Astro.url.toString(),
                        name: area.name,
                    },
                },
            ],
        },
        // LocalBusiness Schema for mobile business
        {
            "@type": ["LocalBusiness", "MusicSchool"],
            "@id": Astro.site?.toString() + "#business",
            name: "髙橋遊月ピアノ教室",
            description: `${area.name}での出張ピアノレッスン。${area.lead}`,
            url: Astro.site?.toString(),
            image: new URL("/senzai.png", Astro.site).toString(),
            telephone: "", // 電話番号があれば追加
            priceRange: "￥5,000～",
            areaServed: {
                "@type": "Place",
                name: area.name,
            },
            serviceType: "出張ピアノレッスン",
            hasOfferCatalog: {
                "@type": "OfferCatalog",
                name: "ピアノレッスン",
                itemListElement: [
                    {
                        "@type": "Offer",
                        itemOffered: {
                            "@type": "Service",
                            name: "無料体験レッスン",
                        },
                    },
                ],
            },
        },
        {
            "@type": "Service",
            name: `${area.name}の出張ピアノ教室`,
            provider: {
                "@type": "MusicSchool",
                name: "髙橋遊月ピアノ教室",
                url: Astro.site?.toString(),
                image: new URL("/senzai.png", Astro.site).toString(),
            },
            areaServed: {
                "@type": "Place",
                name: area.name,
            },
            description: area.lead,
            url: Astro.url.toString(),
            potentialAction: {
                "@type": "ReserveAction",
                target: {
                    "@type": "EntryPoint",
                    urlTemplate: new URL("/contact", Astro.site).toString(),
                },
                result: {
                    "@type": "Reservation",
                    name: "体験レッスン",
                },
            },
        },
        {
            "@type": "FAQPage",
            mainEntity: area.faqs.map((faq) => ({
                "@type": "Question",
                name: faq.question,
                acceptedAnswer: {
                    "@type": "Answer",
                    text: faq.answer,
                },
            })),
        },
    ],
});
---

<Layout
    title={pageTitle}
    description={pageDescription}
    image={area.mainImage}
    keywords={pageKeywords}
>
    <!-- Structured Data -->
    <script slot="head" type="application/ld+json" set:html={schema} />

    <!-- Preload Critical Image -->
    <link slot="head" rel="preload" as="image" href={area.mainImage} />

    <Breadcrumbs
        items={[
            { label: "出張エリア一覧", path: "/area" },
            { label: area.name, path: `/area/${area.slug}` },
        ]}
    />

    <HeroSection area={area} objectPosition={objectPosition} />

    <IntroSection area={area} />

    <UniqueContentSection area={area} />

    <PersonaSection area={area} />

    <CTASection area={area} variant="mid" />

    <InstructorSection area={area} />

    <FeeSection area={area} />

    <LessonFlowSection area={area} />

    <FAQSection area={area} />

    <MapSection area={area} />

    <CTASection area={area} variant="final" />

    <RelatedAreasSection area={area} />
</Layout>
